<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="This article will show you everything you need to know to use PowerShell to setup Windows services and IIS applications.  It’s aimed at complete beginners and is as concise as possible. Why do this in">
<meta property="og:type" content="article">
<meta property="og:title" content="Configuring a machine with PowerShell">
<meta property="og:url" content="https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/index.html">
<meta property="og:site_name" content="Richard JE Cooke">
<meta property="og:description" content="This article will show you everything you need to know to use PowerShell to setup Windows services and IIS applications.  It’s aimed at complete beginners and is as concise as possible. Why do this in">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2014-02-04T19:05:17.000Z">
<meta property="article:modified_time" content="2022-05-27T17:09:22.007Z">
<meta property="article:author" content="Richard JE Cooke">
<meta property="article:tag" content="iis">
<meta property="article:tag" content="powershell">
<meta property="article:tag" content="windows service">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Configuring a machine with PowerShell</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Richard JE Cooke" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">home</a></li><!--
     --><!--
       --><li><a href="/archives/">articles</a></li><!--
     --><!--
       --><li><a href="/music">music</a></li><!--
     --><!--
       --><li><a href="/apps">apps</a></li><!--
     --><!--
       --><li><a href="/cv">cv</a></li><!--
     --><!--
       --><li><a href="/atom.xml">rss feed</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/en/2014/jquery-mobile-notification-popup/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&text=Configuring a machine with PowerShell"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&is_video=false&description=Configuring a machine with PowerShell"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Configuring a machine with PowerShell&body=Check out this article: https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&name=Configuring a machine with PowerShell&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&t=Configuring a machine with PowerShell"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-do-this-in-PowerShell"><span class="toc-number">1.</span> <span class="toc-text">Why do this in PowerShell?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-PowerShell"><span class="toc-number">2.</span> <span class="toc-text">Install PowerShell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-PowerShell-ISE-integrated-scripting-environment"><span class="toc-number">3.</span> <span class="toc-text">Windows PowerShell ISE (integrated scripting environment)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hotkeys"><span class="toc-number">3.1.</span> <span class="toc-text">Hotkeys</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Allow-PowerShell-to-run-scripts"><span class="toc-number">4.</span> <span class="toc-text">Allow PowerShell to run scripts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Make-some-configuration-settings"><span class="toc-number">5.</span> <span class="toc-text">Make some configuration settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Put-the-configuration-in-a-separate-file"><span class="toc-number">6.</span> <span class="toc-text">Put the configuration in a separate file</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Functions-and-parameters"><span class="toc-number">7.</span> <span class="toc-text">Functions and parameters</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Modules-amp-logging"><span class="toc-number">8.</span> <span class="toc-text">Modules &amp; logging</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Calling-DOS-commands"><span class="toc-number">9.</span> <span class="toc-text">Calling DOS commands</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-full-script-with-useful-functions"><span class="toc-number">10.</span> <span class="toc-text">A full script with useful functions</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Configuring a machine with PowerShell
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Richard JE Cooke</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2014-02-04T19:05:17.000Z" itemprop="datePublished">2014-02-04</time>
        
      
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/iis/" rel="tag">iis</a>, <a class="tag-link-link" href="/tags/powershell/" rel="tag">powershell</a>, <a class="tag-link-link" href="/tags/windows-service/" rel="tag">windows service</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>This article will show you everything you need to know to use PowerShell to setup Windows services and IIS applications.  It’s aimed at complete beginners and is as concise as possible.</p>
<h2 id="Why-do-this-in-PowerShell"><a href="#Why-do-this-in-PowerShell" class="headerlink" title="Why do this in PowerShell?"></a>Why do this in PowerShell?</h2><p>I wrote the script discussed in this article to completely automate the configuration of our virtual machines. Whenever a new environment is created for testing or deployment all that needs to be done is to run a script, rather than install and configure everything manually. Why PowerShell? Because it’s the Microsoft standard tool for system administration.</p>
<h2 id="Install-PowerShell"><a href="#Install-PowerShell" class="headerlink" title="Install PowerShell"></a>Install PowerShell</h2><p>Google the latest version of the Windows Management Framework, download and install it.  <a target="_blank" rel="noopener" href="http://www.microsoft.com/en-za/download/details.aspx?id=40855">Version 4 of PowerShell</a> is the latest at the time of writing.</p>
<p><strong>WARNING</strong> Some of the modules available in PowerShell depend on the version of Windows you have, not the version of PowerShell.  If you find a function you are trying to use just isn’t working check in the MSDN documentation to see if its module is in your version of Windows.</p>
<h2 id="Windows-PowerShell-ISE-integrated-scripting-environment"><a href="#Windows-PowerShell-ISE-integrated-scripting-environment" class="headerlink" title="Windows PowerShell ISE (integrated scripting environment)"></a>Windows PowerShell ISE (integrated scripting environment)</h2><p>The ISE is a useful text editor for your scripts and can run them too.</p>
<h3 id="Hotkeys"><a href="#Hotkeys" class="headerlink" title="Hotkeys"></a>Hotkeys</h3><p>- Ctrl 1 to Ctrl 3 change the arrangement of the script and console windows</p>
<ul>
<li>Ctrl R switches between the script and console windows</li>
</ul>
<p><strong>WARNING</strong> The ISE does not clear the PowerShell session whenever you click run. If you make a change to a script used by another script the change won’t be used. This is because all the functions have already been defined in the session. Instead you have to use only one file, or restart the ISE.</p>
<h2 id="Allow-PowerShell-to-run-scripts"><a href="#Allow-PowerShell-to-run-scripts" class="headerlink" title="Allow PowerShell to run scripts"></a>Allow PowerShell to run scripts</h2><p>Start a PowerShell command window and run the following command <code>Set-Executionpolicy RemoteSigned</code></p>
<p>This will allow you to run scripts in the current folder by typing <code>./MyScript.ps1</code></p>
<h2 id="Make-some-configuration-settings"><a href="#Make-some-configuration-settings" class="headerlink" title="Make some configuration settings"></a>Make some configuration settings</h2><p>Let’s look at a basic script</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">Purpose:    </span></span><br><span class="line"><span class="comment">    This script configures a machine.</span></span><br><span class="line"><span class="comment">#&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The line below ensures we have correct version, it is not just a comment</span></span><br><span class="line"><span class="comment">#requires -Version 3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#region Settings</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$folders</span> = <span class="selector-tag">@</span>(</span><br><span class="line">    [<span class="type">pscustomobject</span>] <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;Books&quot;</span>; file = <span class="string">&quot;C:\temp\Books&quot;</span>; user = <span class="string">&quot;EVERYONE&quot;</span>; &#125;;</span><br><span class="line">    [<span class="type">pscustomobject</span>] <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;Sound&quot;</span>; file = <span class="string">&quot;C:\temp\Sound&quot;</span>; user = <span class="string">&quot;EVERYONE&quot;</span>; &#125;;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cls</span></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Starting program&quot;</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$folders</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="variable">$item</span>.file</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Line 1 shows multi-line comments.  </li>
<li>Line 6 shows single line comments. </li>
<li>Line 7 shows an interpreter directive - the script won’t run unless PowerShell is the right version.  </li>
<li>Lines 9 and 16 define a region that you can minimise in the ISE to keep your script uncluttered.  </li>
<li>Line 11 defines a variable. Variables start with $. The @ symbol means the following lines are all one command (otherwise PowerShell thinks one line is one command; there are no semicolon endings). This line also defines an array.  It casts two anonymous dictionaries of three strings to a pscustomerobject.  </li>
<li>Line 18 shows that DOS commands are included in PowerShell, and clears the screen.  </li>
<li>Line 19 allows you to write to the screen and the next few lines show you a foreach loop.</li>
</ul>
<h2 id="Put-the-configuration-in-a-separate-file"><a href="#Put-the-configuration-in-a-separate-file" class="headerlink" title="Put the configuration in a separate file"></a>Put the configuration in a separate file</h2><p>Let’s put the configuration arrays in a separate file so we can edit them separately later. Make a new script called Configuration.ps1 and add these lines:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$version</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$folders</span> = <span class="selector-tag">@</span>(</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;Books&quot;</span>; file = <span class="string">&quot;C:\temp\Books&quot;</span>; user = <span class="string">&quot;EVERYONE&quot;</span>; &#125;;</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;Sound&quot;</span>; file = <span class="string">&quot;C:\temp\Sound&quot;</span>; user = <span class="string">&quot;EVERYONE&quot;</span>; &#125;;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="variable">$windowsServices</span> = <span class="selector-tag">@</span>(</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;Monitoring Service&quot;</span>;     file = <span class="string">&quot;C:\temp\Movie\SystemsMonitor.exe&quot;</span>;                  user = <span class="string">&quot;NetworkService&quot;</span>;         password = <span class="string">&quot;1gn0red&quot;</span> &#125;;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>We can then make a script that uses these settings like so:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Write-Host</span> <span class="variable">$version</span></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Importing configuration settings&quot;</span></span><br><span class="line">. <span class="variable">$PSScriptRoot</span>\Configuration.ps1</span><br><span class="line"><span class="built_in">Write-Host</span> <span class="variable">$version</span></span><br></pre></td></tr></table></figure>

<p><strong>WARNING</strong> Note that line 1 won’t work because the variable hasn’t been defined yet. PowerShell doesn’t look forward through a file - functions and variables must be declared before being used. Line 3 is called dot sourcing. It’s as if the other script file had been copied and pasted into that line. It’s more neat to make your script libraries into standalone reusable modules, but we’ll get to that later.</p>
<h2 id="Functions-and-parameters"><a href="#Functions-and-parameters" class="headerlink" title="Functions and parameters"></a>Functions and parameters</h2><p>Let’s look at a basic function and its use:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-ValueOrUseDefault</span><span class="params">(<span class="variable">$message</span>, <span class="variable">$default</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="built_in">Read-Host</span> <span class="variable">$message</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$input</span> <span class="operator">-eq</span> <span class="variable">$null</span>) &#123; <span class="keyword">return</span> <span class="variable">$default</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$input</span> <span class="operator">-eq</span> <span class="string">&quot;&quot;</span>)    &#123; <span class="keyword">return</span> <span class="variable">$default</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$input</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$scheduledTaskUser</span> = <span class="string">&quot;Richard&quot;</span></span><br><span class="line"><span class="variable">$scheduledTaskUser</span> = <span class="built_in">Get-ValueOrUseDefault</span> (<span class="string">&quot;Enter the user to run scheduled tasks as, or push enter to use the default value &#x27;&quot;</span> + <span class="variable">$scheduledTaskUser</span> + <span class="string">&quot;&#x27;&quot;</span>) (scheduledTaskUser)</span><br></pre></td></tr></table></figure>

<p>Functions work as you’d expect except for a couple of surprises:</p>
<ul>
<li>Line 1: PowerShell expects functions to start with a verb from the list found by running Get-Verb.  It won’t error but will warn you.</li>
<li>Line 4: Comparison operators are -eq for &#x3D;, -ne for &lt;&gt;, -gt for &gt;, and so on. Null, true, and false are represented by $null, $true, and $false.</li>
<li>Line 10: Functions are not called with parameters in brackets, nor separated by commas.  Parameters are separated only by whitespace. Brackets are used to wrap something that contains spaces into one parameter.</li>
<li>Parameters are passed by value unless you preceed the formal and actual parameters by ref. If the function can’t find a variable in the parameter list it will create a global variable (like Javascript if you create a variable without using ‘var’).</li>
</ul>
<h2 id="Modules-amp-logging"><a href="#Modules-amp-logging" class="headerlink" title="Modules &amp; logging"></a>Modules &amp; logging</h2><p>PowerShell groups code for reuse by making modules (similar to packages or assemblies in other languages). Here’s how to import and use a logging module. Download and unzip this logging <a target="_blank" rel="noopener" href="http://gallery.technet.microsoft.com/scriptcenter/PSLog-Send-messages-to-a-db389927">module</a> into a subfolder called PSLog beneath your script. Notice that the folder contains a module manifest file and a code file.  To make your own module just copy this folder and rename the files and manifest information. To import and use the module use this code:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Creating log file&quot;</span></span><br><span class="line"><span class="built_in">Import-Module</span> <span class="variable">$PSScriptRoot</span>\PSLog</span><br><span class="line"><span class="built_in">Start-Log</span> <span class="literal">-LogName</span> PrepareMachineForDTS <span class="literal">-LogPath</span> <span class="variable">$PSScriptRoot</span> <span class="literal">-Level</span> All</span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;I&#x27;m in a file and on the screen&quot;</span></span><br></pre></td></tr></table></figure>

<p>Line 1 will just write to the screen.<br>The module is then imported in line 2 ($PSScriptRoot is the folder the script is in).<br>Line 3 activates it to create a log file and writes further Write-Host output to the file as well as the screen.</p>
<h2 id="Calling-DOS-commands"><a href="#Calling-DOS-commands" class="headerlink" title="Calling DOS commands"></a>Calling DOS commands</h2><p>If you’re not using Windows 8 or the server version you’ll find many missing PowerShell commands and you’ll have to rely on the standard DOS management applications.  Calling them with the correct parameters can be tricky. PowerShell is usually pretty clever and correctly surrounds a variable’s content with “ “ when passing it as parameter.  But if it doesn’t work put the whole command in a string and run it like this:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$command</span> = <span class="string">&quot;cmd /c &#x27;&quot;</span> + <span class="string">&quot;schtasks /create /tn `&quot;&quot;</span> + <span class="variable">$item</span>.name + <span class="string">&quot;`&quot; /TR  `&quot;&quot;</span> + <span class="variable">$item</span>.file + <span class="string">&quot;`&quot; /RU &quot;</span> + <span class="variable">$scheduledTaskUser</span> + <span class="string">&quot; /RP &quot;</span> + <span class="variable">$scheduledTaskUserPassword</span> + <span class="string">&quot; &quot;</span> + <span class="variable">$item</span>.schedule + <span class="string">&quot;&#x27;&quot;</span>  </span><br><span class="line"><span class="variable">$output</span> = <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="variable">$output</span></span><br></pre></td></tr></table></figure>

<h2 id="A-full-script-with-useful-functions"><a href="#A-full-script-with-useful-functions" class="headerlink" title="A full script with useful functions"></a>A full script with useful functions</h2><p>That’s about it. We’ve covered the basics of PowerShell and all the suprises for a novice user. The code below gives you a lot of useful functions to create folders, share folders on the network, create IIS applications, create scheduled tasks, and create Windows services. It’s quite simple but if you have questions please ask them in a comment at the bottom of this page.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$folders</span>  = <span class="selector-tag">@</span>(</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;file = <span class="string">&quot;C:\temp\movie&quot;</span>;   &#125;;</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;file = <span class="string">&quot;C:\temp\sound&quot;</span>;   &#125;;    </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="variable">$sharedFolders</span> = <span class="selector-tag">@</span>(</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;movie&quot;</span>; file = <span class="string">&quot;C:\movie&quot;</span>; user = <span class="string">&quot;EVERYONE&quot;</span>;     &#125;;</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;sound&quot;</span>; file = <span class="string">&quot;C:\temp\sound&quot;</span>; user = <span class="string">&quot;EVERYONE&quot;</span>;     &#125;;    </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="variable">$scheduledTasks</span> = <span class="selector-tag">@</span>(</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;Run movies&quot;</span>; file = <span class="string">&quot;C:\temp\movie\Go.bat&quot;</span>;  enabled = <span class="variable">$true</span>; schedule=<span class="string">&quot; /ST 19:00 /SC DAILY &quot;</span>  &#125;;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="variable">$windowsServices</span> = <span class="selector-tag">@</span>(</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;Monitor movie&quot;</span>;     file = <span class="string">&quot;C:\temp\movie&quot;</span>; user = <span class="string">&quot;NetworkService&quot;</span>; password = <span class="string">&quot;1gn0red&quot;</span> &#125;;    </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="variable">$virtualDirectories</span> = <span class="selector-tag">@</span>(</span><br><span class="line">    pscustomobject <span class="selector-tag">@</span>&#123;name=<span class="string">&quot;MovieSite&quot;</span>; file=<span class="string">&quot;C:\temp\movie\webapp&quot;</span>; user=<span class="string">&quot;NetworkService&quot;</span>; password = <span class="string">&quot;1gn0red&quot;</span>;   authentication=<span class="string">&quot;Windows&quot;</span>          &#125;;  </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The line below ensures we have correct version, it is not just a comment</span></span><br><span class="line"><span class="comment">#requires -Version 3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#region Functions</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-ParentFolder</span><span class="params">(<span class="variable">$folder</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">Split-Path</span> <span class="literal">-parent</span> <span class="variable">$folder</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Confirm-WindowsServiceExists</span><span class="params">(<span class="variable">$name</span>)</span></span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Get-Service</span> <span class="variable">$name</span> <span class="literal">-ErrorAction</span> SilentlyContinue)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Remove-WindowsServiceIfItExists</span><span class="params">(<span class="variable">$name</span>)</span></span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="variable">$exists</span> = <span class="built_in">Confirm-WindowsServiceExists</span> <span class="variable">$name</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$exists</span>)</span><br><span class="line">    &#123;    </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Remove Windows service - &quot;</span> <span class="variable">$name</span></span><br><span class="line">        <span class="variable">$output</span> = (sc.exe delete <span class="variable">$name</span>)</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="variable">$output</span></span><br><span class="line">    &#125;       </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Confirm-ScheduledTaskExists</span><span class="params">(<span class="variable">$name</span>)</span></span></span><br><span class="line">&#123;   </span><br><span class="line">    schtasks /query /TN <span class="variable">$name</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span>&gt;null       <span class="comment">#hide error and standard output from displaying</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$LastExitCode</span> <span class="operator">-eq</span> <span class="number">0</span>       <span class="comment">#if task exists exit code won&#x27;t be an error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Remove-ScheduledTaskIfItExists</span><span class="params">(<span class="variable">$name</span>)</span></span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="variable">$exists</span> = <span class="built_in">Confirm-ScheduledTaskExists</span> <span class="variable">$name</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$exists</span>)</span><br><span class="line">    &#123;        </span><br><span class="line">        <span class="variable">$output</span> = (schtasks /delete /f /tn <span class="variable">$name</span>)  <span class="comment">#/f = suppress confirmation message so it can delete without user input            </span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="variable">$output</span></span><br><span class="line">    &#125;       </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Initialize-Logging</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$parentFolder</span> = <span class="built_in">Get-Parent</span><span class="literal">-Folder</span> <span class="variable">$PSScriptRoot</span></span><br><span class="line">    <span class="built_in">Import-Module</span> <span class="variable">$parentFolder</span>\PSLog       <span class="comment"># allows us to write a log file of this machine setup.  sourced from: http://gallery.technet.microsoft.com/scriptcenter/PSLog-Send-messages-to-a-db389927</span></span><br><span class="line">    <span class="built_in">Start-Log</span> <span class="literal">-LogName</span> PrepareMachineForDTS <span class="literal">-LogPath</span> <span class="variable">$parentFolder</span> <span class="literal">-Level</span> All</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Protect-Password</span><span class="params">(<span class="variable">$password</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="variable">$password</span> | <span class="built_in">ConvertTo-SecureString</span> <span class="literal">-asPlainText</span> <span class="literal">-Force</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-WindowsServices</span><span class="params">(<span class="variable">$windowsServices</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Creating Windows services&quot;</span>        </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$windowsServices</span>)</span><br><span class="line">    &#123;        </span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Adding Windows service - &quot;</span> <span class="variable">$item</span>.name</span><br><span class="line">        <span class="variable">$securePassword</span> = <span class="built_in">Protect-Password</span> <span class="variable">$item</span>.password</span><br><span class="line">        <span class="variable">$user</span> = <span class="built_in">New-Object</span> System.Management.Automation.PSCredential (<span class="variable">$item</span>.user, <span class="variable">$securePassword</span> )</span><br><span class="line">        <span class="built_in">New-Service</span> <span class="literal">-name</span> <span class="variable">$item</span>.name <span class="literal">-binaryPathName</span> <span class="variable">$item</span>.file <span class="literal">-credential</span> <span class="variable">$user</span></span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-ScheduledTasks</span><span class="params">(<span class="variable">$scheduledTaskUser</span>, <span class="variable">$scheduledTaskUserPassword</span>, <span class="variable">$scheduledTasks</span>)</span></span></span><br><span class="line">&#123;    </span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Creating scheduled tasks&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$scheduledTasks</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;cmd /c &#x27;&quot;</span> + <span class="string">&quot;schtasks /create /tn `&quot;&quot;</span> + <span class="variable">$item</span>.name + <span class="string">&quot;`&quot; /TR  `&quot;&quot;</span> + <span class="variable">$item</span>.file + <span class="string">&quot;`&quot; /RU &quot;</span> + <span class="variable">$scheduledTaskUser</span> + <span class="string">&quot; /RP &quot;</span> + <span class="variable">$scheduledTaskUserPassword</span> + <span class="string">&quot; &quot;</span> + <span class="variable">$item</span>.schedule + <span class="string">&quot;&#x27;&quot;</span>  </span><br><span class="line">        <span class="variable">$command</span></span><br><span class="line">        <span class="variable">$output</span> = <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="variable">$output</span>        </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$item</span>.enabled <span class="operator">-eq</span> <span class="variable">$true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;schtasks /change /tn `&quot;&quot;</span> + <span class="variable">$item</span>.name + <span class="string">&quot;`&quot; /DISABLE&quot;</span>  </span><br><span class="line">        <span class="variable">$command</span></span><br><span class="line">        <span class="variable">$output</span> = <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="variable">$output</span></span><br><span class="line">    &#125;            </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Remove-ScheduledTasks</span><span class="params">(<span class="variable">$scheduledTasks</span>)</span></span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Deleting scheduled tasks if they exist&quot;</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$scheduledTasks</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Remove-ScheduledTaskIfItExists</span>(<span class="variable">$item</span>.name)</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Remove-WindowsServices</span><span class="params">(<span class="variable">$services</span>)</span></span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Deleting Windows services if they exist&quot;</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$services</span>)</span><br><span class="line">    &#123;        </span><br><span class="line">        <span class="built_in">Remove-WindowsServiceIfItExists</span>(<span class="variable">$item</span>.name)</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-ValueOrUseDefault</span><span class="params">(<span class="variable">$message</span>, <span class="variable">$default</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="built_in">Read-Host</span> <span class="variable">$message</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$input</span> <span class="operator">-eq</span> <span class="variable">$null</span>) &#123; <span class="keyword">return</span> <span class="variable">$default</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$input</span> <span class="operator">-eq</span> <span class="string">&quot;&quot;</span>)    &#123; <span class="keyword">return</span> <span class="variable">$default</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$input</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-AppPool</span><span class="params">(<span class="variable">$virtualDirectory</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Creating IIS app pool - &quot;</span> <span class="variable">$virtualDirectory</span>.name    </span><br><span class="line">    <span class="variable">$poolName</span> = <span class="string">&quot;IIS:\AppPools\&quot;</span> + <span class="variable">$virtualDirectory</span>.name</span><br><span class="line">    <span class="variable">$pool</span> = <span class="built_in">New-Item</span> <span class="variable">$poolName</span></span><br><span class="line">    <span class="variable">$pool</span>.processModel.userName = <span class="variable">$virtualDirectory</span>.user</span><br><span class="line">    <span class="variable">$pool</span>.processModel.password = <span class="variable">$virtualDirectory</span>.password</span><br><span class="line">    <span class="variable">$pool</span>.processModel.identityType = <span class="string">&quot;SpecificUser&quot;</span></span><br><span class="line">    <span class="variable">$pool</span>.processModel.idleTimeout = TimeSpan <span class="string">&quot;0.00:00:00&quot;</span></span><br><span class="line">    <span class="variable">$pool</span>.managedRuntimeVersion = <span class="string">&quot;4.0&quot;</span></span><br><span class="line">    <span class="variable">$pool</span>.recycling.periodicRestart.time = TimeSpan <span class="string">&quot;00:00:00&quot;</span></span><br><span class="line">    <span class="variable">$pool</span> | <span class="built_in">Set-Item</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-VirtualDirectory</span><span class="params">(<span class="variable">$virtualDirectory</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Creating IIS virtual directory - &quot;</span> <span class="variable">$virtualDirectory</span>.name</span><br><span class="line">    <span class="variable">$name</span> = <span class="string">&quot;IIS:\Sites\Default Web Site\&quot;</span> + <span class="variable">$virtualDirectory</span>.name</span><br><span class="line">    <span class="built_in">New-Item</span> <span class="variable">$name</span> <span class="literal">-Type</span> Application <span class="literal">-physicalPath</span> <span class="variable">$virtualDirectory</span>.file</span><br><span class="line">    <span class="built_in">Set-ItemProperty</span> <span class="variable">$name</span> <span class="literal">-Name</span> applicationPool <span class="literal">-Value</span> <span class="variable">$virtualDirectory</span>.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-WindowsAuthenticationToAppIfNecessary</span><span class="params">(<span class="variable">$virtualDirectory</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$virtualDirectory</span>.authentication <span class="operator">-ne</span> <span class="string">&quot;Windows&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Setting Windows authentication for IIS app - &quot;</span> <span class="variable">$virtualDirectory</span>.name</span><br><span class="line">    <span class="variable">$command</span> = <span class="variable">$env:SystemRoot</span> + <span class="string">&quot;\system32\inetsrv\AppCmd.exe set config `&quot;Default Web Site/&quot;</span>+<span class="variable">$virtualDirectory</span>.name+<span class="string">&quot;`&quot; -section:system.webServer/security/authentication/anonymousAuthentication /enabled:`&quot;False`&quot; /commit:apphost&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="variable">$command</span></span><br><span class="line">    <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$command</span> = <span class="variable">$env:SystemRoot</span> + <span class="string">&quot;\system32\inetsrv\AppCmd.exe set config `&quot;Default Web Site/&quot;</span>+<span class="variable">$virtualDirectory</span>.name+<span class="string">&quot;`&quot; -section:system.webServer/security/authentication/windowsAuthentication /enabled:`&quot;True`&quot; /commit:apphost&quot;</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="variable">$command</span></span><br><span class="line">    <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-VirtualDirectories</span><span class="params">(<span class="variable">$virtualDirectories</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    C:\Windows\system32\inetsrv\AppCmd.exe unlock config  /section:security/authentication/anonymousAuthentication <span class="comment"># allow us to make changed to authentication types of apps</span></span><br><span class="line">    C:\Windows\system32\inetsrv\AppCmd.exe unlock config  /section:security/authentication/windowsAuthentication   <span class="comment"># allow us to make changed to authentication types of apps</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$virtualDirectory</span> <span class="keyword">in</span> <span class="variable">$virtualDirectories</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Add-AppPool</span> <span class="variable">$virtualDirectory</span></span><br><span class="line">        <span class="built_in">Add-VirtualDirectory</span> <span class="variable">$virtualDirectory</span>                </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Remove-VirtualDirectories</span><span class="params">(<span class="variable">$virtualDirectories</span>)</span></span></span><br><span class="line">&#123;            </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$virtualDirectories</span>)</span><br><span class="line">    &#123;        </span><br><span class="line">        <span class="variable">$pool</span> = <span class="string">&quot;IIS:\AppPools\&quot;</span> + <span class="variable">$item</span>.name</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Test-Path</span> <span class="variable">$pool</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;Removing IIS app pool - &quot;</span> <span class="variable">$item</span>.name            </span><br><span class="line">            <span class="built_in">Remove-Item</span> <span class="variable">$pool</span> <span class="literal">-Force</span> <span class="literal">-Recurse</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$exists</span> = <span class="built_in">Confirm-VirtualDirectoryExists</span> <span class="variable">$item</span>.name</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$exists</span> <span class="operator">-eq</span> <span class="variable">$false</span> <span class="operator">-or</span> <span class="variable">$item</span>.name <span class="operator">-eq</span> <span class="string">&quot;&quot;</span> <span class="operator">-or</span> <span class="variable">$item</span>.name <span class="operator">-eq</span> <span class="variable">$null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Removing IIS virtual directory - &quot;</span> <span class="variable">$item</span>.name</span><br><span class="line">        <span class="variable">$parameter</span> = <span class="string">&quot;IIS:\Sites\Default Web Site\&quot;</span> + <span class="variable">$item</span>.name</span><br><span class="line">        <span class="built_in">Remove-Item</span> <span class="variable">$parameter</span> <span class="literal">-Recurse</span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Confirm-VirtualDirectoryExists</span><span class="params">(<span class="variable">$name</span>)</span></span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="variable">$parameter</span> = <span class="string">&quot;IIS:\Sites\Default Web Site\&quot;</span> + <span class="variable">$item</span>.name</span><br><span class="line">    <span class="built_in">Get-Item</span> <span class="variable">$parameter</span> <span class="literal">-ErrorAction</span> SilentlyContinue    </span><br><span class="line">    <span class="keyword">return</span> (<span class="variable">$</span>?) <span class="comment">#if last command was successful return true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-WindowsServiceUsers</span><span class="params">(<span class="variable">$windowsServices</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$windowsServices</span>)</span><br><span class="line">    &#123;        </span><br><span class="line">        <span class="variable">$message</span> =   <span class="string">&quot;Enter the user to run the Windows service &#x27;&quot;</span> + <span class="variable">$item</span>.name + <span class="string">&quot;&#x27; as, or push enter to use the default value &#x27;&quot;</span> + <span class="variable">$item</span>.user + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">        <span class="variable">$item</span>.user = <span class="built_in">Get-ValueOrUseDefault</span> <span class="variable">$message</span> <span class="variable">$item</span>.user</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$message</span> =   <span class="string">&quot;Enter the password for this user, or push enter to use the default value &#x27;&quot;</span> + <span class="variable">$item</span>.password + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">        <span class="variable">$item</span>.password = <span class="built_in">Get-ValueOrUseDefault</span> <span class="variable">$message</span> <span class="variable">$item</span>.password</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Get-IisUsers</span><span class="params">(<span class="variable">$virtualDirectories</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$virtualDirectories</span>)</span><br><span class="line">    &#123;        </span><br><span class="line">        <span class="variable">$message</span> =   <span class="string">&quot;Enter the user to run the IIS app &#x27;&quot;</span> + <span class="variable">$item</span>.name + <span class="string">&quot;&#x27; as, or push enter to use the default value &#x27;&quot;</span> + <span class="variable">$item</span>.user + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">        <span class="variable">$item</span>.user = <span class="built_in">Get-ValueOrUseDefault</span> <span class="variable">$message</span> <span class="variable">$item</span>.user</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$message</span> =   <span class="string">&quot;Enter the password for this user, or push enter to use the default value &#x27;&quot;</span> + <span class="variable">$item</span>.password + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">        <span class="variable">$item</span>.password = <span class="built_in">Get-ValueOrUseDefault</span> <span class="variable">$message</span> <span class="variable">$item</span>.password</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-FolderIfItDoesNotExist</span><span class="params">(<span class="variable">$path</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$folderExists</span> = <span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$path</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$folderExists</span> <span class="operator">-eq</span> <span class="variable">$false</span>) <span class="comment"># leave folder alone if it exists</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Adding new folder &quot;</span> <span class="variable">$path</span></span><br><span class="line">        <span class="variable">$output</span> = <span class="built_in">New-Item</span> <span class="literal">-ItemType</span> Directory <span class="literal">-Path</span> <span class="variable">$path</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="variable">$output</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-Folders</span><span class="params">(<span class="variable">$folders</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$folders</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Add-FolderIfItDoesNotExist</span> <span class="variable">$item</span>.file</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add-SharedFolders</span><span class="params">(<span class="variable">$sharedFolders</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Adding folders shared on network&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$share</span> = WMICLASS <span class="string">&quot;WIN32_Share&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$sharedFolders</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Add-FolderIfItDoesNotExist</span> <span class="variable">$item</span>.file    </span><br><span class="line"></span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;(Get-WmiObject -Class Win32_Share -ComputerName . -Filter `&quot;Name=&#x27;&quot;</span> + <span class="variable">$item</span>.name + <span class="string">&quot;&#x27;`&quot;)&quot;</span></span><br><span class="line">        <span class="variable">$shareExists</span> = <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$shareExists</span> <span class="operator">-ne</span>  <span class="variable">$null</span>)  <span class="comment"># remove share if it exists, in case it points to the wrong folder</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;Deleting network share - &quot;</span> <span class="variable">$item</span>.name    </span><br><span class="line">            <span class="variable">$command</span> = <span class="string">&quot;(Get-WmiObject -Class Win32_Share -ComputerName . -Filter `&quot;Name=&#x27;&quot;</span> + <span class="variable">$item</span>.name + <span class="string">&quot;&#x27;`&quot;).InvokeMethod(`&quot;Delete`&quot;,`$null)&quot;</span></span><br><span class="line">            <span class="variable">$command</span></span><br><span class="line">            <span class="variable">$output</span> = <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="variable">$output</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Adding network share - &quot;</span> <span class="variable">$item</span>.name</span><br><span class="line">        <span class="comment">#$output = $share.Create($item.file, $item.name, 0)  # the powershell way of doing it doesn&#x27;t grant rights</span></span><br><span class="line">        <span class="variable">$command</span> = <span class="string">&quot;cmd /c &#x27; net share `&quot;&quot;</span> + <span class="variable">$item</span>.name + <span class="string">&quot;`&quot;=`&quot;&quot;</span>+<span class="variable">$item</span>.file+<span class="string">&quot;`&quot; /GRANT:&quot;</span>+<span class="variable">$item</span>.user+<span class="string">&quot;,FULL&#x27;&quot;</span></span><br><span class="line">        <span class="variable">$output</span> = <span class="built_in">Invoke-Expression</span> <span class="variable">$command</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="variable">$output</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Open-FireWallPort</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Opening firewall port 8085 for TCP on the domain only.&quot;</span></span><br><span class="line">    <span class="variable">$port</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> HNetCfg.FWOpenPort</span><br><span class="line">    <span class="variable">$port</span>.Port = <span class="number">8085</span></span><br><span class="line">    <span class="variable">$port</span>.Name = <span class="string">&#x27;Movie port has been opened&#x27;</span></span><br><span class="line">    <span class="variable">$port</span>.Enabled = <span class="variable">$true</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$fwMgr</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> HNetCfg.FwMgr</span><br><span class="line">    <span class="variable">$profile</span>=<span class="variable">$fwMgr</span>.LocalPolicy.GetProfileByType(<span class="number">0</span>)  <span class="comment">#domain profile only</span></span><br><span class="line">    <span class="variable">$profile</span>.GloballyOpenPorts.Add(<span class="variable">$port</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#endregion</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cls</span></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Starting program&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Creating log file&quot;</span></span><br><span class="line"><span class="built_in">Import-Module</span> <span class="variable">$PSScriptRoot</span>\PSLog       <span class="comment"># allows us to write a log file of this machine setup.  sourced from: http://gallery.technet.microsoft.com/scriptcenter/PSLog-Send-messages-to-a-db389927</span></span><br><span class="line"><span class="built_in">Start-Log</span> <span class="literal">-LogName</span> PrepareMachineForDTS <span class="literal">-LogPath</span> <span class="variable">$PSScriptRoot</span> <span class="literal">-Level</span> All</span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;___________________________________________________&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$scheduledTaskUser</span> = <span class="string">&quot;NetworkService&quot;</span></span><br><span class="line"><span class="variable">$scheduledTaskUserPassword</span> = <span class="string">&quot;1gn0r3d&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Importing PowerShell IIS functions&quot;</span></span><br><span class="line"><span class="built_in">Import-Module</span> WebAdministration</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Getting all settings needed from the user&quot;</span></span><br><span class="line"><span class="built_in">Get-WindowsServiceUsers</span> <span class="variable">$windowsServices</span></span><br><span class="line"><span class="built_in">Get-IisUsers</span>(<span class="variable">$virtualDirectories</span>)</span><br><span class="line"><span class="variable">$scheduledTaskUser</span> = <span class="built_in">Get-ValueOrUseDefault</span> (<span class="string">&quot;Enter the user to run scheduled tasks as, or push enter to use the default value &#x27;&quot;</span> + <span class="variable">$scheduledTaskUser</span> + <span class="string">&quot;&#x27;&quot;</span>) (scheduledTaskUser)</span><br><span class="line"><span class="variable">$scheduledTaskUserPassword</span> = <span class="built_in">Get-ValueOrUseDefault</span> (<span class="string">&quot;Enter the password for this user, or push enter to use the default value &#x27;&quot;</span> + <span class="variable">$scheduledTaskUserPassword</span> + <span class="string">&quot;&#x27;&quot;</span>) (scheduledTaskUserPassword)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Open-FireWallPort</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Add-Folders</span> <span class="variable">$folders</span></span><br><span class="line"><span class="built_in">Add-SharedFolders</span> <span class="variable">$sharedFolders</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Remove-ScheduledTasks</span> <span class="variable">$scheduledTasks</span></span><br><span class="line"><span class="built_in">Add-ScheduledTasks</span> <span class="variable">$scheduledTaskUser</span> <span class="variable">$scheduledTaskUserPassword</span> <span class="variable">$scheduledTasks</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Remove-WindowsServices</span> <span class="variable">$windowsServices</span></span><br><span class="line"><span class="built_in">Add-WindowsServices</span> <span class="variable">$windowsServices</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Remove-VirtualDirectories</span> <span class="variable">$virtualDirectories</span></span><br><span class="line"><span class="built_in">Add-VirtualDirectories</span> <span class="variable">$virtualDirectories</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Closing log file&quot;</span></span><br><span class="line"><span class="built_in">Stop-Log</span></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Log closed. Program finished&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># The line below ensures we have correct version, it is not just a comment</span></span><br><span class="line"><span class="comment">#requires -Version 3.0</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#region Settings</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">$apiSourceFolder</span> = <span class="string">&quot;.\src\WebAPI\*&quot;</span></span><br><span class="line"><span class="variable">$apiDeploymentFolder</span> = <span class="string">&quot;\\10.10.10.30\Web.Api.V1.Dev&quot;</span></span><br><span class="line"><span class="variable">$configFilename</span> = <span class="variable">$apiDeploymentFolder</span> + <span class="string">&quot;\Web.config&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#endregion</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">cls</span></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Starting program&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Copy contents of web api folder to dev&quot;</span></span><br><span class="line"><span class="built_in">Copy-Item</span> <span class="variable">$apiSourceFolder</span> <span class="variable">$apiDeploymentFolder</span> <span class="literal">-recurse</span> <span class="literal">-force</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Change dev config file&quot;</span></span><br><span class="line">(<span class="built_in">Get-Content</span> <span class="variable">$configFilename</span>).replace(<span class="string">&#x27;connectionString=&quot;Dsn=DEV64&quot;&#x27;</span>,<span class="string">&#x27;connectionString=&quot;Dsn=CLB-DEV&quot;&#x27;</span>) | <span class="built_in">Set-Content</span> <span class="variable">$configFilename</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Finished&quot;</span></span><br></pre></td></tr></table></figure>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">home</a></li>
         
          <li><a href="/archives/">articles</a></li>
         
          <li><a href="/music">music</a></li>
         
          <li><a href="/apps">apps</a></li>
         
          <li><a href="/cv">cv</a></li>
         
          <li><a href="/atom.xml">rss feed</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-do-this-in-PowerShell"><span class="toc-number">1.</span> <span class="toc-text">Why do this in PowerShell?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-PowerShell"><span class="toc-number">2.</span> <span class="toc-text">Install PowerShell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-PowerShell-ISE-integrated-scripting-environment"><span class="toc-number">3.</span> <span class="toc-text">Windows PowerShell ISE (integrated scripting environment)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hotkeys"><span class="toc-number">3.1.</span> <span class="toc-text">Hotkeys</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Allow-PowerShell-to-run-scripts"><span class="toc-number">4.</span> <span class="toc-text">Allow PowerShell to run scripts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Make-some-configuration-settings"><span class="toc-number">5.</span> <span class="toc-text">Make some configuration settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Put-the-configuration-in-a-separate-file"><span class="toc-number">6.</span> <span class="toc-text">Put the configuration in a separate file</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Functions-and-parameters"><span class="toc-number">7.</span> <span class="toc-text">Functions and parameters</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Modules-amp-logging"><span class="toc-number">8.</span> <span class="toc-text">Modules &amp; logging</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Calling-DOS-commands"><span class="toc-number">9.</span> <span class="toc-text">Calling DOS commands</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-full-script-with-useful-functions"><span class="toc-number">10.</span> <span class="toc-text">A full script with useful functions</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&text=Configuring a machine with PowerShell"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&is_video=false&description=Configuring a machine with PowerShell"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Configuring a machine with PowerShell&body=Check out this article: https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&title=Configuring a machine with PowerShell"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&name=Configuring a machine with PowerShell&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://richardcooke.info/en/2014/configuring-a-machine-with-powershell-a-quick-guide-for-beginners/&t=Configuring a machine with PowerShell"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 Richard JE Cooke
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">home</a></li><!--
     --><!--
       --><li><a href="/archives/">articles</a></li><!--
     --><!--
       --><li><a href="/music">music</a></li><!--
     --><!--
       --><li><a href="/apps">apps</a></li><!--
     --><!--
       --><li><a href="/cv">cv</a></li><!--
     --><!--
       --><li><a href="/atom.xml">rss feed</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-56673091-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-56673091-1');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
