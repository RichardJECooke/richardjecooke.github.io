<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Settings in Azure applications should not be kept in the app.config nor web.config file.  You also don’t need to change the settings files for different environments when building (dev, qa, prod).  Az">
<meta property="og:type" content="article">
<meta property="og:title" content="Settings in Azure">
<meta property="og:url" content="https://richardcooke.info/en/2014/settings-in-azure/index.html">
<meta property="og:site_name" content="Richard JE Cooke">
<meta property="og:description" content="Settings in Azure applications should not be kept in the app.config nor web.config file.  You also don’t need to change the settings files for different environments when building (dev, qa, prod).  Az">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://richardcooke.info/AzureSettings1.png">
<meta property="og:image" content="https://richardcooke.info/AzureSettings2.png">
<meta property="og:image" content="https://richardcooke.info/AzureSettings3.png">
<meta property="article:published_time" content="2014-10-19T11:13:27.000Z">
<meta property="article:modified_time" content="2022-05-27T17:09:22.110Z">
<meta property="article:author" content="Richard JE Cooke">
<meta property="article:tag" content="azure">
<meta property="article:tag" content="c#">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://richardcooke.info/AzureSettings1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Settings in Azure</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Richard JE Cooke" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">home</a></li><!--
     --><!--
       --><li><a href="/archives/">articles</a></li><!--
     --><!--
       --><li><a href="/music">music</a></li><!--
     --><!--
       --><li><a href="/apps">apps</a></li><!--
     --><!--
       --><li><a href="/cv">cv</a></li><!--
     --><!--
       --><li><a href="/atom.xml">rss feed</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/en/2014/how-to-migrate-azure-environments/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/en/2014/how-to-upload-a-file-to-an-azure-storage-account/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://richardcooke.info/en/2014/settings-in-azure/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://richardcooke.info/en/2014/settings-in-azure/&text=Settings in Azure"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://richardcooke.info/en/2014/settings-in-azure/&is_video=false&description=Settings in Azure"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Settings in Azure&body=Check out this article: https://richardcooke.info/en/2014/settings-in-azure/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://richardcooke.info/en/2014/settings-in-azure/&name=Settings in Azure&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://richardcooke.info/en/2014/settings-in-azure/&t=Settings in Azure"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#The-old-way"><span class="toc-number">1.</span> <span class="toc-text">The old way</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-problems-with-this-approach"><span class="toc-number">2.</span> <span class="toc-text">The problems with this approach</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Azure%E2%80%99s-cloud-configuration-settings"><span class="toc-number">3.</span> <span class="toc-text">Azure’s cloud configuration settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-benefits-of-Azure%E2%80%99s-settings"><span class="toc-number">4.</span> <span class="toc-text">The benefits of Azure’s settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-use-Azure-settings"><span class="toc-number">5.</span> <span class="toc-text">How to use Azure settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Connection-strings"><span class="toc-number">6.</span> <span class="toc-text">Connection strings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Overwriting-settings"><span class="toc-number">7.</span> <span class="toc-text">Overwriting settings</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Settings in Azure
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Richard JE Cooke</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2014-10-19T11:13:27.000Z" itemprop="datePublished">2014-10-19</time>
        
      
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/azure/" rel="tag">azure</a>, <a class="tag-link-link" href="/tags/c/" rel="tag">c#</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Settings in Azure applications should not be kept in the app.config nor web.config file.  You also don’t need to change the settings files for different environments when building (dev, qa, prod).  Azure makes it much easier.  Here’s how it works.</p>
<h2 id="The-old-way"><a href="#The-old-way" class="headerlink" title="The old way"></a>The old way</h2><p>In the image below I’ve made a brand new Azure cloud service with one web application included.  I’ve added an app setting the old way that I’m used to.<br><img src="/AzureSettings1.png" alt="AzureSettings1"> </p>
<p>You can use the setting in your application like this:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> setting = ConfigurationManager.AppSettings[<span class="string">&quot;CdnUrl&quot;</span>];</span><br></pre></td></tr></table></figure>

<h2 id="The-problems-with-this-approach"><a href="#The-problems-with-this-approach" class="headerlink" title="The problems with this approach"></a>The problems with this approach</h2><p>There are a few difficulties with this approach</p>
<ul>
<li>You have to replace this configuration file on each environment you publish to with different values</li>
<li>The connection string (and other settings) are unencrypted. So any developer (or anyone with access to your source control) can see the production database password.</li>
</ul>
<h2 id="Azure’s-cloud-configuration-settings"><a href="#Azure’s-cloud-configuration-settings" class="headerlink" title="Azure’s cloud configuration settings"></a>Azure’s cloud configuration settings</h2><p>Azure provides a new way of reading configurations setting, called CloudConfigurationManager.  You use it like this:</p>
<p>var setting &#x3D; CloudConfigurationManager.GetSetting(“CdnUrl”);</p>
<p>It will work just fine with the app settings in the image above.  However it has two extra features:</p>
<ul>
<li>If a setting with the same name is found in the cloud service project’s role’s .cscfg file it will use that setting instead of the web.config one.</li>
<li>If a setting with the same name is found on Azure in the cloud (configured through the Azure website) it will use that setting instead of the .cscfg or the web.config one.</li>
</ul>
<h2 id="The-benefits-of-Azure’s-settings"><a href="#The-benefits-of-Azure’s-settings" class="headerlink" title="The benefits of Azure’s settings"></a>The benefits of Azure’s settings</h2><p>These two features mean that you can put all your localhost \ development environment settings in the .cscfg file while programming.  Then all you have to do is have someone with production permissions to log on to the Azure website and change the production settings that no one else may see.  This keeps everything private and secure.</p>
<h2 id="How-to-use-Azure-settings"><a href="#How-to-use-Azure-settings" class="headerlink" title="How to use Azure settings"></a>How to use Azure settings</h2><p>Open the website role’s properties page in Visual Studio and add a new setting with the same name as the one in the web.config file (or just delete the web.config settings section entirely).<br><img src="/AzureSettings2.png" alt="AzureSettings2"></p>
<p>Now in the Azure portal change the settings for each cloud service environment you deploy to.<br><img src="/AzureSettings3.png" alt="AzureSettings3"></p>
<h2 id="Connection-strings"><a href="#Connection-strings" class="headerlink" title="Connection strings"></a>Connection strings</h2><p>I used these settings to store my Entity Framework connection string.  Instead of constructing a new</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DbContext(<span class="string">&quot;connectionStringName&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>you now pass in the connection string itself after reading it from settings, like so</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DbContext(CloudConfigurationManager.GetSetting(<span class="string">&quot;connectionStringName&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>Entity Framework doesn’t actually need the ProviderName attribute for construction so it works without error. To set log4net’s connection string use this method:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetLog4NetAdoNetAppenderConnectionString</span>(<span class="params"><span class="built_in">string</span> connectionString</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">var</span> hierarchy = (Hierarchy) LogManager.GetRepository();</span><br><span class="line">   <span class="keyword">if</span> (hierarchy == <span class="literal">null</span>)</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">   <span class="keyword">var</span> appenders = hierarchy.GetAppenders().OfType&lt;AdoNetAppender&gt;();</span><br><span class="line">   <span class="keyword">foreach</span> (<span class="keyword">var</span> appender <span class="keyword">in</span> appenders)</span><br><span class="line">   &#123;</span><br><span class="line">       appender.ConnectionString = connectionString;</span><br><span class="line">       appender.ActivateOptions();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> </p>
<h2 id="Overwriting-settings"><a href="#Overwriting-settings" class="headerlink" title="Overwriting settings"></a>Overwriting settings</h2><p>The only problem with this system is that a deployment will overwrite the settings in the cloud with whatever is in the .cscfg file.  You’ll have to change them again in the portal by hand.</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">home</a></li>
         
          <li><a href="/archives/">articles</a></li>
         
          <li><a href="/music">music</a></li>
         
          <li><a href="/apps">apps</a></li>
         
          <li><a href="/cv">cv</a></li>
         
          <li><a href="/atom.xml">rss feed</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#The-old-way"><span class="toc-number">1.</span> <span class="toc-text">The old way</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-problems-with-this-approach"><span class="toc-number">2.</span> <span class="toc-text">The problems with this approach</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Azure%E2%80%99s-cloud-configuration-settings"><span class="toc-number">3.</span> <span class="toc-text">Azure’s cloud configuration settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-benefits-of-Azure%E2%80%99s-settings"><span class="toc-number">4.</span> <span class="toc-text">The benefits of Azure’s settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-use-Azure-settings"><span class="toc-number">5.</span> <span class="toc-text">How to use Azure settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Connection-strings"><span class="toc-number">6.</span> <span class="toc-text">Connection strings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Overwriting-settings"><span class="toc-number">7.</span> <span class="toc-text">Overwriting settings</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://richardcooke.info/en/2014/settings-in-azure/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://richardcooke.info/en/2014/settings-in-azure/&text=Settings in Azure"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://richardcooke.info/en/2014/settings-in-azure/&is_video=false&description=Settings in Azure"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Settings in Azure&body=Check out this article: https://richardcooke.info/en/2014/settings-in-azure/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://richardcooke.info/en/2014/settings-in-azure/&title=Settings in Azure"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://richardcooke.info/en/2014/settings-in-azure/&name=Settings in Azure&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://richardcooke.info/en/2014/settings-in-azure/&t=Settings in Azure"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 Richard JE Cooke
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">home</a></li><!--
     --><!--
       --><li><a href="/archives/">articles</a></li><!--
     --><!--
       --><li><a href="/music">music</a></li><!--
     --><!--
       --><li><a href="/apps">apps</a></li><!--
     --><!--
       --><li><a href="/cv">cv</a></li><!--
     --><!--
       --><li><a href="/atom.xml">rss feed</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-56673091-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-56673091-1');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
